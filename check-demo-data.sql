-- =====================================================
-- DEMO VERƒ∞LERƒ∞Nƒ∞ KONTROL ETME SCRIPTI
-- =====================================================
-- Bu script mevcut demo/test verilerini listeler
-- Temizlik √∂ncesi ve sonrasƒ± kar≈üƒ±la≈ütƒ±rma i√ßin kullanƒ±n
-- =====================================================

-- Ba≈ülƒ±k
SELECT '========================================' as "TEMƒ∞ZLƒ∞K √ñNCESƒ∞ DEMO VERƒ∞LERƒ∞ RAPORU";
SELECT '========================================' as "----------------------------------------";

-- =====================================================
-- 1. E-COMMERCE VERƒ∞LERƒ∞
-- =====================================================

SELECT 
    'üè∑Ô∏è E-COMMERCE VERƒ∞LERƒ∞' as "Kategori",
    '' as "Tablo",
    '' as "Toplam",
    '' as "Demo",
    '' as "Ger√ßek";

SELECT 
    '‚îú‚îÄ' as "Kategori",
    'categories' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN is_demo = false OR is_demo IS NULL THEN 1 END)::text as "Ger√ßek"
FROM categories;

SELECT 
    '‚îú‚îÄ' as "Kategori",
    'products' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN is_demo = false OR is_demo IS NULL THEN 1 END)::text as "Ger√ßek"
FROM products;

SELECT 
    '‚îú‚îÄ' as "Kategori",
    'sellers' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN is_demo = false OR is_demo IS NULL THEN 1 END)::text as "Ger√ßek"
FROM sellers;

SELECT 
    '‚îî‚îÄ' as "Kategori",
    'product_reviews' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN is_demo = false OR is_demo IS NULL THEN 1 END)::text as "Ger√ßek"
FROM product_reviews;

-- =====================================================
-- 2. KULLANICI VERƒ∞LERƒ∞
-- =====================================================

SELECT '' as ""; -- Bo≈ü satƒ±r

SELECT 
    'üë• KULLANICI VERƒ∞LERƒ∞' as "Kategori",
    '' as "Tablo",
    '' as "Toplam",
    '' as "Demo",
    '' as "Ger√ßek";

SELECT 
    '‚îú‚îÄ' as "Kategori",
    'admin_users' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true OR email ILIKE '%@example.com' OR email ILIKE '%@demo.com' OR email ILIKE '%@test.com' THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN (is_demo = false OR is_demo IS NULL) AND email NOT ILIKE '%@example.com' AND email NOT ILIKE '%@demo.com' AND email NOT ILIKE '%@test.com' THEN 1 END)::text as "Ger√ßek"
FROM admin_users;

SELECT 
    '‚îú‚îÄ' as "Kategori",
    'site_users' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true OR email ILIKE '%@example.com' OR email ILIKE '%@demo.com' OR email ILIKE '%@test.com' THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN (is_demo = false OR is_demo IS NULL) AND email NOT ILIKE '%@example.com' AND email NOT ILIKE '%@demo.com' AND email NOT ILIKE '%@test.com' THEN 1 END)::text as "Ger√ßek"
FROM site_users;

SELECT 
    '‚îî‚îÄ' as "Kategori",
    'customers' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true OR email ILIKE '%@example.com' OR email ILIKE '%@demo.com' OR email ILIKE '%@test.com' THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN (is_demo = false OR is_demo IS NULL) AND email NOT ILIKE '%@example.com' AND email NOT ILIKE '%@demo.com' AND email NOT ILIKE '%@test.com' THEN 1 END)::text as "Ger√ßek"
FROM customers;

-- =====================================================
-- 3. Sƒ∞PARƒ∞≈û VERƒ∞LERƒ∞
-- =====================================================

SELECT '' as ""; -- Bo≈ü satƒ±r

SELECT 
    'üõí Sƒ∞PARƒ∞≈û VERƒ∞LERƒ∞' as "Kategori",
    '' as "Tablo",
    '' as "Toplam",
    '' as "Demo",
    '' as "Ger√ßek";

SELECT 
    '‚îú‚îÄ' as "Kategori",
    'orders' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true OR customer_email ILIKE '%@example.com' OR customer_email ILIKE '%@demo.com' OR customer_email ILIKE '%@test.com' THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN (is_demo = false OR is_demo IS NULL) AND customer_email NOT ILIKE '%@example.com' AND customer_email NOT ILIKE '%@demo.com' AND customer_email NOT ILIKE '%@test.com' THEN 1 END)::text as "Ger√ßek"
FROM orders;

SELECT 
    '‚îú‚îÄ' as "Kategori",
    'invoices' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true OR customer_email ILIKE '%@example.com' OR customer_email ILIKE '%@demo.com' OR customer_email ILIKE '%@test.com' THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN (is_demo = false OR is_demo IS NULL) AND customer_email NOT ILIKE '%@example.com' AND customer_email NOT ILIKE '%@demo.com' AND customer_email NOT ILIKE '%@test.com' THEN 1 END)::text as "Ger√ßek"
FROM invoices;

SELECT 
    '‚îî‚îÄ' as "Kategori",
    'coupons' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN is_demo = false OR is_demo IS NULL THEN 1 END)::text as "Ger√ßek"
FROM coupons;

-- =====================================================
-- 4. MUHASEBE VERƒ∞LERƒ∞
-- =====================================================

SELECT '' as ""; -- Bo≈ü satƒ±r

SELECT 
    'üíº MUHASEBE VERƒ∞LERƒ∞' as "Kategori",
    '' as "Tablo",
    '' as "Toplam",
    '' as "Demo",
    '' as "Ger√ßek";

SELECT 
    '‚îú‚îÄ' as "Kategori",
    'companies' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN id = '550e8400-e29b-41d4-a716-446655440000' THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN id != '550e8400-e29b-41d4-a716-446655440000' THEN 1 END)::text as "Ger√ßek"
FROM companies;

SELECT 
    '‚îú‚îÄ' as "Kategori",
    'accounts' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN company_id = '550e8400-e29b-41d4-a716-446655440000' THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN company_id != '550e8400-e29b-41d4-a716-446655440000' THEN 1 END)::text as "Ger√ßek"
FROM accounts;

SELECT 
    '‚îú‚îÄ' as "Kategori",
    'journal_entries' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN company_id = '550e8400-e29b-41d4-a716-446655440000' THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN company_id != '550e8400-e29b-41d4-a716-446655440000' THEN 1 END)::text as "Ger√ßek"
FROM journal_entries;

SELECT 
    '‚îî‚îÄ' as "Kategori",
    'contacts' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN company_id = '550e8400-e29b-41d4-a716-446655440000' THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN company_id != '550e8400-e29b-41d4-a716-446655440000' THEN 1 END)::text as "Ger√ßek"
FROM contacts;

-- =====================================================
-- 5. BLOG VE ƒ∞√áERƒ∞K
-- =====================================================

SELECT '' as ""; -- Bo≈ü satƒ±r

SELECT 
    'üìù BLOG VE ƒ∞√áERƒ∞K' as "Kategori",
    '' as "Tablo",
    '' as "Toplam",
    '' as "Demo",
    '' as "Ger√ßek";

SELECT 
    '‚îú‚îÄ' as "Kategori",
    'blog_posts' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN is_demo = false OR is_demo IS NULL THEN 1 END)::text as "Ger√ßek"
FROM blog_posts;

SELECT 
    '‚îî‚îÄ' as "Kategori",
    'comments' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true OR author_email ILIKE '%@example.com' OR author_email ILIKE '%@demo.com' OR author_email ILIKE '%@test.com' THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN (is_demo = false OR is_demo IS NULL) AND author_email NOT ILIKE '%@example.com' AND author_email NOT ILIKE '%@demo.com' AND author_email NOT ILIKE '%@test.com' THEN 1 END)::text as "Ger√ßek"
FROM comments;

-- =====================================================
-- 6. KAMPANYA VE PAZARLAMA
-- =====================================================

SELECT '' as ""; -- Bo≈ü satƒ±r

SELECT 
    'üì£ KAMPANYA VE PAZARLAMA' as "Kategori",
    '' as "Tablo",
    '' as "Toplam",
    '' as "Demo",
    '' as "Ger√ßek";

SELECT 
    '‚îú‚îÄ' as "Kategori",
    'campaigns' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN is_demo = false OR is_demo IS NULL THEN 1 END)::text as "Ger√ßek"
FROM campaigns;

SELECT 
    '‚îî‚îÄ' as "Kategori",
    'gift_cards' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true OR recipient_email ILIKE '%@example.com' OR recipient_email ILIKE '%@demo.com' OR recipient_email ILIKE '%@test.com' THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN (is_demo = false OR is_demo IS NULL) AND recipient_email NOT ILIKE '%@example.com' AND recipient_email NOT ILIKE '%@demo.com' AND recipient_email NOT ILIKE '%@test.com' THEN 1 END)::text as "Ger√ßek"
FROM gift_cards;

-- =====================================================
-- 7. √áALI≈ûAN VERƒ∞LERƒ∞
-- =====================================================

SELECT '' as ""; -- Bo≈ü satƒ±r

SELECT 
    'üëî √áALI≈ûAN VERƒ∞LERƒ∞' as "Kategori",
    '' as "Tablo",
    '' as "Toplam",
    '' as "Demo",
    '' as "Ger√ßek";

SELECT 
    '‚îî‚îÄ' as "Kategori",
    'employees' as "Tablo",
    COUNT(*)::text as "Toplam",
    COUNT(CASE WHEN is_demo = true OR email ILIKE '%@example.com' OR email ILIKE '%@demo.com' OR email ILIKE '%@test.com' THEN 1 END)::text as "Demo",
    COUNT(CASE WHEN (is_demo = false OR is_demo IS NULL) AND email NOT ILIKE '%@example.com' AND email NOT ILIKE '%@demo.com' AND email NOT ILIKE '%@test.com' THEN 1 END)::text as "Ger√ßek"
FROM employees;

-- =====================================================
-- 8. √ñZET ƒ∞STATƒ∞STƒ∞KLER
-- =====================================================

SELECT '' as ""; -- Bo≈ü satƒ±r
SELECT '========================================' as "√ñZET ƒ∞STATƒ∞STƒ∞KLER";
SELECT '========================================' as "----------------------------------------";

-- Toplam demo veri sayƒ±sƒ±
WITH demo_counts AS (
    SELECT 'categories' as tablo, COUNT(*) as sayi FROM categories WHERE is_demo = true
    UNION ALL
    SELECT 'products', COUNT(*) FROM products WHERE is_demo = true
    UNION ALL
    SELECT 'sellers', COUNT(*) FROM sellers WHERE is_demo = true
    UNION ALL
    SELECT 'orders', COUNT(*) FROM orders WHERE is_demo = true OR customer_email ILIKE '%@example.com' OR customer_email ILIKE '%@demo.com' OR customer_email ILIKE '%@test.com'
    UNION ALL
    SELECT 'customers', COUNT(*) FROM customers WHERE is_demo = true OR email ILIKE '%@example.com' OR email ILIKE '%@demo.com' OR email ILIKE '%@test.com'
    UNION ALL
    SELECT 'admin_users', COUNT(*) FROM admin_users WHERE is_demo = true OR (email ILIKE '%@example.com' AND email != 'bentahasarii@gmail.com') OR (email ILIKE '%@demo.com' AND email != 'bentahasarii@gmail.com') OR (email ILIKE '%@test.com' AND email != 'bentahasarii@gmail.com')
    UNION ALL
    SELECT 'blog_posts', COUNT(*) FROM blog_posts WHERE is_demo = true
    UNION ALL
    SELECT 'campaigns', COUNT(*) FROM campaigns WHERE is_demo = true
)
SELECT 
    'üìä Toplam Demo Kayƒ±t' as "Kategori",
    SUM(sayi)::text as "Sayƒ±"
FROM demo_counts;

-- Admin kullanƒ±cƒ± durumu
SELECT 
    'üîê Ana Admin Durumu' as "Kategori",
    CASE 
        WHEN COUNT(*) > 0 THEN '‚úÖ Korunacak (bentahasarii@gmail.com)'
        ELSE '‚ùå Bulunamadƒ±'
    END as "Durum"
FROM admin_users
WHERE email = 'bentahasarii@gmail.com';

SELECT '' as ""; -- Bo≈ü satƒ±r
SELECT '========================================' as "----------------------------------------";
SELECT '‚úÖ Kontrol tamamlandƒ±!' as "Durum";
SELECT 'üí° Demo verileri temizlemek i√ßin clean-demo-data.sql scriptini √ßalƒ±≈ütƒ±rƒ±n' as "Not";
SELECT '========================================' as "----------------------------------------";

